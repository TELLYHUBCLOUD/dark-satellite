<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication - O Level Exam Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="auth-wrapper">
        <div class="container-auth {{ 'right-panel-active' if active_panel == 'register' else '' }}" id="container">
            <!-- Sign Up Form -->
            <div class="form-container sign-up-container">
                <form id="registerForm">
                    <h1>Create Account</h1>

                    <span>or use your email for registration</span>
                    <input type="text" id="reg-name" placeholder="Name" required />
                    <input type="email" id="reg-email" placeholder="Email" required />
                    <input type="tel" id="reg-phone" placeholder="Phone (10 digits)" required pattern="[0-9]{10}" />
                    <input type="date" id="reg-dob" placeholder="Date of Birth" required />
                    <select id="reg-subject" required>
                        <option value="" disabled selected>Select Subject</option>
                        <option value="Python">Python</option>
                        <option value="Web Design">Web Design</option>
                        <option value="IoT">IoT</option>
                        <option value="Computer Fundamentals">Computer Fundamentals</option>
                    </select>
                    <input type="password" id="reg-password" placeholder="Password" required minlength="6" />
                    <button type="submit">Sign Up</button>
                    <div id="reg-alert" class="alert-msg"></div>
                </form>
            </div>

            <!-- Sign In Form -->
            <div class="form-container sign-in-container">
                <form id="loginForm">
                    <h1>Sign in</h1>

                    <span>or use your account</span>
                    <input type="text" id="login-roll" placeholder="Roll Number" required />
                    <input type="password" id="login-password" placeholder="Password" required />
                    <input type="date" id="login-dob" placeholder="Date of Birth" required />
                    <a href="#">Forgot your password?</a>
                    <button type="submit">Sign In</button>
                    <div id="login-alert" class="alert-msg"></div>
                </form>
            </div>

            <!-- Overlay -->
            <div class="overlay-container">
                <div class="overlay">
                    <div class="overlay-panel overlay-left">
                        <h1>Welcome Back!</h1>
                        <p>To keep connected with us please login with your personal info</p>
                        <button class="ghost" id="signIn">Sign In</button>
                    </div>
                    <div class="overlay-panel overlay-right">
                        <h1>Hello, Friend!</h1>
                        <p>Enter your personal details and start your journey with us</p>
                        <button class="ghost" id="signUp">Sign Up</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const signUpButton = document.getElementById('signUp');
        const signInButton = document.getElementById('signIn');
        const container = document.getElementById('container');

        signUpButton.addEventListener('click', () => {
            container.classList.add("right-panel-active");
        });

        signInButton.addEventListener('click', () => {
            container.classList.remove("right-panel-active");
        });

        // Register Logic
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const alert = document.getElementById('reg-alert');
            alert.textContent = 'Processing...';
            alert.className = 'alert-msg info';

            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            const dob = document.getElementById('reg-dob').value;
            const subject = document.getElementById('reg-subject').value;
            const password = document.getElementById('reg-password').value;

            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, phone, dob, subject, password })
                });
                const data = await res.json();
                if (data.success) {
                    alert.textContent = `Success! Roll No: ${data.roll_number}`;
                    alert.className = 'alert-msg success';
                    setTimeout(() => {
                        container.classList.remove("right-panel-active"); // Switch to login
                        alert.textContent = '';
                        document.getElementById('registerForm').reset();
                    }, 3000);
                } else {
                    alert.textContent = data.message;
                    alert.className = 'alert-msg error';
                }
            } catch (err) {
                alert.textContent = 'Error: ' + err.message;
                alert.className = 'alert-msg error';
            }
        });

        // Login Logic
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const alert = document.getElementById('login-alert');
            alert.textContent = 'Verifying...';
            alert.className = 'alert-msg info';

            const roll_number = document.getElementById('login-roll').value;
            const password = document.getElementById('login-password').value;
            const dob = document.getElementById('login-dob').value;

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ roll_number, password, dob })
                });
                const data = await res.json();
                if (data.success) {
                    alert.textContent = 'Login Successful!';
                    alert.className = 'alert-msg success';
                    window.location.href = data.redirect;
                } else {
                    alert.textContent = data.message;
                    alert.className = 'alert-msg error';
                }
            } catch (err) {
                alert.textContent = 'Error: ' + err.message;
                alert.className = 'alert-msg error';
            }
        });
    </script>
</body>

</html>